---
/**
 * CarruselImagesTrakt - Carrusel de imágenes nativo para el modal
 * Muestra: fanart, logo, clearart, banner, thumb
 */
---

<div id="modal-carousel-container" class="hidden w-[224px] mt-4">
    <div id="carousel-wrapper" class="relative rounded-md bg-gray-800/50 border border-gray-700 overflow-hidden h-[185px]">
        <!-- Slides Container -->
        <div id="carousel-slides" class="flex transition-transform duration-300 ease-out h-full">
            <!-- Las imágenes se agregan dinámicamente -->
        </div>

        <!-- Navigation Arrows -->
        <button
            id="carousel-prev"
            class="absolute left-1 bottom-2 p-1.5 bg-black/60 hover:bg-black/80 rounded-full text-white transition-colors z-10"
            aria-label="Anterior"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <button
            id="carousel-next"
            class="absolute right-1 bottom-2 p-1.5 bg-black/60 hover:bg-black/80 rounded-full text-white transition-colors z-10"
            aria-label="Siguiente"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
        </button>

        <!-- Dots Indicator -->
        <div id="carousel-dots" class="absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5 z-10">
            <!-- Los dots se agregan dinámicamente -->
        </div>

        <!-- Image Type Label -->
        <div id="carousel-label" class="absolute top-1 left-1 px-2 py-0.5 bg-black/70 rounded text-xs font-mono text-gray-300 z-10">
            <!-- Se actualiza dinámicamente -->
        </div>
    </div>
</div>

<style>
    #carousel-slides {
        will-change: transform;
    }

    .carousel-slide {
        width: 224px;
        min-width: 224px;
        height: 100%;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.25rem;
        box-sizing: border-box;
    }

    .carousel-slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .carousel-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.4);
        transition: background-color 0.2s, transform 0.2s;
        cursor: pointer;
        border: none;
        padding: 0;
    }

    .carousel-dot:hover {
        background-color: rgba(255, 255, 255, 0.6);
    }

    .carousel-dot.active {
        background-color: #0ea5e9;
        transform: scale(1.3);
    }
</style>

<script is:inline>
(function() {
    var currentSlide = 0;
    var totalSlides = 0;
    var imageTypes = [];

    function initCarousel() {
        var prevBtn = document.getElementById('carousel-prev');
        var nextBtn = document.getElementById('carousel-next');

        if (prevBtn) {
            var newPrev = prevBtn.cloneNode(true);
            prevBtn.parentNode.replaceChild(newPrev, prevBtn);
            newPrev.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                goToSlide(currentSlide - 1);
            });
        }

        if (nextBtn) {
            var newNext = nextBtn.cloneNode(true);
            nextBtn.parentNode.replaceChild(newNext, nextBtn);
            newNext.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                goToSlide(currentSlide + 1);
            });
        }
    }

    function goToSlide(index) {
        if (totalSlides === 0) return;

        // Loop around
        if (index < 0) index = totalSlides - 1;
        if (index >= totalSlides) index = 0;

        currentSlide = index;

        var slidesContainer = document.getElementById('carousel-slides');
        if (slidesContainer) {
            slidesContainer.style.transform = 'translateX(-' + (currentSlide * 224) + 'px)';
        }

        updateDots();
        updateLabel();
    }

    function updateDots() {
        var dots = document.querySelectorAll('.carousel-dot');
        dots.forEach(function(dot, i) {
            if (i === currentSlide) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }

    function updateLabel() {
        var label = document.getElementById('carousel-label');
        if (label && imageTypes[currentSlide]) {
            label.textContent = imageTypes[currentSlide];
        }
    }

    // Exponer función global para cargar imágenes
    window.loadCarouselImages = function(images) {
        var container = document.getElementById('modal-carousel-container');
        var slidesContainer = document.getElementById('carousel-slides');
        var dotsContainer = document.getElementById('carousel-dots');

        if (!container || !slidesContainer || !dotsContainer) return;

        // Limpiar contenido previo
        slidesContainer.innerHTML = '';
        dotsContainer.innerHTML = '';
        currentSlide = 0;
        imageTypes = [];

        // Tipos de imagen en orden
        var types = ['fanart', 'logo', 'clearart', 'banner', 'thumb'];
        var validImages = [];

        types.forEach(function(type) {
            if (images && images[type]) {
                validImages.push({ type: type, url: images[type] });
                imageTypes.push(type);
            }
        });

        totalSlides = validImages.length;

        if (totalSlides === 0) {
            container.classList.add('hidden');
            return;
        }

        // Establecer ancho del contenedor de slides
        slidesContainer.style.width = (totalSlides * 224) + 'px';

        // Crear slides
        validImages.forEach(function(img) {
            var slide = document.createElement('div');
            slide.className = 'carousel-slide';
            slide.style.width = '224px';
            slide.style.minWidth = '224px';
            slide.style.height = '100%';
            slide.style.display = 'flex';
            slide.style.alignItems = 'center';
            slide.style.justifyContent = 'center';
            slide.style.flexShrink = '0';

            var imgEl = document.createElement('img');
            imgEl.src = img.url;
            imgEl.alt = img.type;
            imgEl.style.maxWidth = '100%';
            imgEl.style.maxHeight = '100%';
            imgEl.style.objectFit = 'contain';
            imgEl.style.borderRadius = '0.375rem';

            slide.appendChild(imgEl);
            slidesContainer.appendChild(slide);
        });

        // Crear dots
        for (var i = 0; i < totalSlides; i++) {
            var dot = document.createElement('button');
            dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
            dot.setAttribute('aria-label', 'Ir a imagen ' + (i + 1));
            dot.dataset.index = i;
            dot.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                goToSlide(parseInt(e.target.dataset.index));
            });
            dotsContainer.appendChild(dot);
        }

        // Mostrar carrusel y actualizar label
        container.classList.remove('hidden');
        slidesContainer.style.transform = 'translateX(0px)';
        updateLabel();
    };

    // Inicializar
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCarousel);
    } else {
        initCarousel();
    }
    document.addEventListener('astro:after-swap', initCarousel);
})();
</script>
