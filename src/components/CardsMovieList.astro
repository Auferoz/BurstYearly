---
const TRAKT_CLIENT_ID = import.meta.env.TRAKT_CLIENT_ID;

const { year } = Astro.props

let movies = [];
let error = null;

try {
    console.log('TRAKT_CLIENT_ID exists:', !!TRAKT_CLIENT_ID);

    const response = await fetch(
        `https://api.trakt.tv/users/auferoz/lists/movies-${year}/items/movies?extended=full,images`,
        {
            headers: {
                "Content-Type": "application/json",
                "trakt-api-key": TRAKT_CLIENT_ID,
                "trakt-api-version": "2",
            },
        }
    );

    console.log('Response status:', response.status);

    if (!response.ok) {
        error = `Error ${response.status}: ${response.statusText}`;
    } else {
        movies = await response.json();
    }
} catch (e) {
    error = e.message;
    console.error('Fetch error:', e);
}
---

{error && <p class="text-red-500 col-span-full">{error}</p>}

{
    movies.toReversed().map((item) => (
        <article class="flex flex-col gap-2 justify-between relative">
            {/* <div class="absolute top-0 left-0 w-0 h-0 border-l-[30px] border-l-red-800 border-b-[30px] border-b-transparent z-2">
                <span class="absolute -top-[-1px] -left-[25px] text-white text-xs font-bold">
                    {Math.ceil(item.movie.rating)}
                </span>
            </div> */}
            <img
                src={`https://${item.movie.images?.poster?.[0] || ''}`}
                alt={item.movie.title}
                class="w-full rounded-lg border border-gray-700"
            />
            {/* <p class="text-sm tracking-widest font-medium text-white text-center">
                {item.movie.title} ({item.movie.year})
            </p> */}
        </article>
    ))
}
