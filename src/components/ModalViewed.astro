---
/**
 * ModalViewed - Modal minimalista para mostrar información de películas/series
 * Se activa mediante JavaScript desde las cards
 */
---

<!-- Modal Container -->
<div id="modal-viewed" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <!-- Overlay -->
    <div id="modal-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
    
    <!-- Modal Content -->
    <div id="modal-content" class="relative w-full max-w-5xl max-h-[90vh] overflow-y-auto bg-zinc-900 border border-gray-700 rounded-xl shadow-2xl">
        
        <!-- Header -->
        <div class="sticky top-0 z-10 flex items-center justify-between p-4 bg-zinc-900/95 backdrop-blur border-b border-gray-700">
            <h2 id="modal-title" class="text-lg md:text-xl font-bold text-white truncate pr-4">Título</h2>
            <button id="modal-close" class="flex-shrink-0 p-2 rounded-lg bg-gray-800 hover:bg-gray-700 border border-gray-600 hover:border-sky-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Body -->
        <div class="flex flex-col md:flex-row gap-6 p-4 md:p-6">
            
            <!-- Poster -->
            <div class="flex-shrink-0 mx-auto md:mx-0">
                <img 
                    id="modal-poster" 
                    src="" 
                    alt="Poster" 
                    class="w-48 md:w-56 rounded-lg border border-gray-700 shadow-lg"
                />
            </div>

            <!-- Info -->
            <div class="flex-1 flex flex-col gap-4">
                
                <!-- Meta Info Row -->
                <div class="flex flex-wrap gap-2">
                    <!-- Año -->
                    <span id="modal-year" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gray-800 border border-gray-600 rounded-lg text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span class="year-value">2024</span>
                    </span>

                    <!-- Rating -->
                    <span id="modal-rating" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-sky-900/50 border border-sky-700 rounded-lg text-sky-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <span class="rating-value">8</span>/10
                    </span>

                    <!-- Runtime -->
                    <span id="modal-runtime" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gray-800 border border-gray-600 rounded-lg text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="runtime-value">120</span> min
                    </span>

                    <!-- Plataforma -->
                    <span id="modal-platform" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gray-800 border border-gray-600 rounded-lg text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <span class="platform-value">Netflix</span>
                    </span>

                    <!-- Tipo (Movie/Series) -->
                    <span id="modal-type" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gray-800 border border-gray-600 rounded-lg text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                        </svg>
                        <span class="type-value">Movie</span>
                    </span>

                    <!-- Episodes (solo para series) -->
                    <span id="modal-episodes" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-purple-900/50 border border-purple-700 rounded-lg text-purple-300 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                        </svg>
                        <span class="episodes-value">10</span> eps
                    </span>

                    <!-- Country -->
                    <span id="modal-country" class="FiraCodeFont inline-flex items-center gap-1.5 px-3 py-1.5 text-xs bg-gray-800 border border-gray-600 rounded-lg text-gray-300 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="country-value">US</span>
                    </span>
                </div>

                <!-- Géneros -->
                <div id="modal-genres" class="flex flex-wrap gap-2">
                    <!-- Se llenan dinámicamente -->
                </div>

                <!-- Director -->
                <div id="modal-director-container" class="hidden">
                    <h3 class="text-sm font-semibold text-gray-400 mb-2 uppercase tracking-wider">Director</h3>
                    <span id="modal-director" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm bg-amber-900/30 border border-amber-700/50 rounded-lg text-amber-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        <span class="director-value">Director Name</span>
                    </span>
                </div>

                <!-- Actores -->
                <div id="modal-actors-container" class="hidden">
                    <h3 class="text-sm font-semibold text-gray-400 mb-2 uppercase tracking-wider">Actores</h3>
                    <div id="modal-actors" class="flex flex-wrap gap-2">
                        <!-- Se llenan dinámicamente -->
                    </div>
                </div>

                <!-- Sinopsis -->
                <div class="flex-1">
                    <h3 class="text-sm font-semibold text-gray-400 mb-2 uppercase tracking-wider">Sinopsis</h3>
                    <p id="modal-overview" class="text-sm md:text-base text-gray-300 leading-relaxed">
                        Sin descripción disponible.
                    </p>
                </div>

                <!-- Trailer Button -->
                <div id="modal-trailer-container" class="hidden pt-2">
                    <a 
                        id="modal-trailer-link" 
                        href="#" 
                        target="_blank" 
                        class="inline-flex items-center gap-2 px-4 py-2 bg-sky-700 hover:bg-sky-600 border border-sky-600 rounded-lg text-white text-sm font-medium transition-colors"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Ver Trailer
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>

<style>
    #modal-viewed {
        animation: fadeIn 0.2s ease-out;
    }

    #modal-viewed.hidden {
        display: none;
    }

    #modal-viewed:not(.hidden) {
        display: flex;
    }

    #modal-content {
        animation: slideUp 0.3s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(20px) scale(0.98);
        }
        to { 
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Scrollbar styling */
    #modal-content::-webkit-scrollbar {
        width: 6px;
    }

    #modal-content::-webkit-scrollbar-track {
        background: transparent;
    }

    #modal-content::-webkit-scrollbar-thumb {
        background: #374151;
        border-radius: 3px;
    }

    #modal-content::-webkit-scrollbar-thumb:hover {
        background: #4b5563;
    }
</style>

<script is:inline>
    // Modal functionality - IIFE para evitar conflictos
    (function() {
        function initModal() {
            var modal = document.getElementById('modal-viewed');
            var overlay = document.getElementById('modal-overlay');
            var closeBtn = document.getElementById('modal-close');

            if (!modal || !overlay || !closeBtn) return;

            // Close modal function
            function closeModal() {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }

            // Remove old listeners by cloning
            var newOverlay = overlay.cloneNode(true);
            overlay.parentNode.replaceChild(newOverlay, overlay);
            newOverlay.addEventListener('click', closeModal);

            var newCloseBtn = closeBtn.cloneNode(true);
            closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
            newCloseBtn.addEventListener('click', closeModal);

            // Close with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        }

        // Open modal with data - exposed globally
        window.openModalViewed = function(data) {
            var modal = document.getElementById('modal-viewed');
            if (!modal) return;

            // Get elements
            var title = document.getElementById('modal-title');
            var poster = document.getElementById('modal-poster');
            var yearEl = document.querySelector('#modal-year .year-value');
            var ratingEl = document.querySelector('#modal-rating .rating-value');
            var ratingContainer = document.getElementById('modal-rating');
            var runtimeEl = document.querySelector('#modal-runtime .runtime-value');
            var runtimeContainer = document.getElementById('modal-runtime');
            var platformEl = document.querySelector('#modal-platform .platform-value');
            var platformContainer = document.getElementById('modal-platform');
            var typeEl = document.querySelector('#modal-type .type-value');
            var genresContainer = document.getElementById('modal-genres');
            var overview = document.getElementById('modal-overview');
            var trailerContainer = document.getElementById('modal-trailer-container');
            var trailerLink = document.getElementById('modal-trailer-link');

            // Title
            if (title) title.textContent = data.title || 'Sin título';
            
            // Poster
            if (poster) {
                poster.setAttribute('src', data.poster || 'https://placehold.co/224x336?text=No+Poster');
                poster.setAttribute('alt', data.title || 'Poster');
            }
            
            // Year
            if (yearEl) yearEl.textContent = String(data.year || 'N/A');
            
            // Rating
            if (ratingEl && ratingContainer) {
                if (data.rating) {
                    ratingEl.textContent = String(data.rating);
                    ratingContainer.classList.remove('hidden');
                } else {
                    ratingContainer.classList.add('hidden');
                }
            }

            // Runtime
            if (runtimeEl && runtimeContainer) {
                if (data.runtime) {
                    runtimeEl.textContent = String(data.runtime);
                    runtimeContainer.classList.remove('hidden');
                } else {
                    runtimeContainer.classList.add('hidden');
                }
            }

            // Platform
            if (platformEl && platformContainer) {
                if (data.platform) {
                    platformEl.textContent = String(data.platform);
                    platformContainer.classList.remove('hidden');
                } else {
                    platformContainer.classList.add('hidden');
                }
            }

            // Type
            if (typeEl) typeEl.textContent = data.type || 'Movie';

            // Episodes (solo para series)
            var episodesEl = document.querySelector('#modal-episodes .episodes-value');
            var episodesContainer = document.getElementById('modal-episodes');
            if (episodesEl && episodesContainer) {
                if (data.episodes && data.type === 'Serie') {
                    episodesEl.textContent = String(data.episodes);
                    episodesContainer.classList.remove('hidden');
                } else {
                    episodesContainer.classList.add('hidden');
                }
            }

            // Country
            var countryEl = document.querySelector('#modal-country .country-value');
            var countryContainer = document.getElementById('modal-country');
            if (countryEl && countryContainer) {
                if (data.country) {
                    countryEl.textContent = data.country.toUpperCase();
                    countryContainer.classList.remove('hidden');
                } else {
                    countryContainer.classList.add('hidden');
                }
            }

            // Genres
            if (genresContainer) {
                genresContainer.innerHTML = '';
                if (data.genres && data.genres.length > 0) {
                    data.genres.forEach(function(genre) {
                        var badge = document.createElement('span');
                        badge.className = 'px-2.5 py-1 text-xs bg-gray-800 border border-gray-600 rounded-full text-gray-400';
                        badge.textContent = genre;
                        genresContainer.appendChild(badge);
                    });
                }
            }

            // Director
            var directorEl = document.querySelector('#modal-director .director-value');
            var directorContainer = document.getElementById('modal-director-container');
            if (directorEl && directorContainer) {
                if (data.director) {
                    directorEl.textContent = data.director;
                    directorContainer.classList.remove('hidden');
                } else {
                    directorContainer.classList.add('hidden');
                }
            }

            // Actors
            var actorsContainer = document.getElementById('modal-actors');
            var actorsWrapper = document.getElementById('modal-actors-container');
            if (actorsContainer && actorsWrapper) {
                actorsContainer.innerHTML = '';
                if (data.actors && data.actors.length > 0) {
                    data.actors.forEach(function(actor) {
                        var badge = document.createElement('span');
                        badge.className = 'inline-flex items-center gap-1.5 px-2.5 py-1 text-xs bg-gray-800 border border-gray-600 rounded-full text-gray-300';
                        badge.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>' + actor;
                        actorsContainer.appendChild(badge);
                    });
                    actorsWrapper.classList.remove('hidden');
                } else {
                    actorsWrapper.classList.add('hidden');
                }
            }

            // Overview
            if (overview) overview.textContent = data.overview || 'Sin descripción disponible.';

            // Trailer
            if (trailerContainer && trailerLink) {
                if (data.trailer) {
                    trailerLink.setAttribute('href', data.trailer);
                    trailerContainer.classList.remove('hidden');
                } else {
                    trailerContainer.classList.add('hidden');
                }
            }

            // Show modal
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        // Initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initModal);
        } else {
            initModal();
        }
        document.addEventListener('astro:after-swap', initModal);
    })();
</script>
